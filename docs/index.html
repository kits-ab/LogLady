<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="shortcut icon" href="./resources/icon.ico" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=yes"
    />
    <title>LogLady</title>

    <style>
      body {
        background: #222;
        height: 100%;
        margin: 0;
        font-family: Menlo, "Courier New", Courier, monospace;
        line-height: 1.5em;
      }

      a {
        color: #ccc;
        text-decoration: none;
      }
      a:hover {
        color: #ab0f78;
      }

      .start-container {
        display: flex;
        flex-direction: row;
        height: 600px;
        color: #ccc;
        align-items: center;
        justify-content: center;
        width: 100%;
      }

      .content-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        background: #ccc;
        color: #222;
        width: 100%;
      }

      .logLady-logo {
        width: 550px;
        align-self: center;
      }
      .info-what {
        width: 700px;
        align-self: center;
      }

      .info-how {
        align-self: center;
        width: 700px;
      }

      .img-logladyGif {
        width: 100%;
      }

      .img-highlightAndFilter {
        width: 100%;
        margin-bottom: 60px;
      }
      .img-follow {
        width: 150px;
      }

      .btn {
        padding: 0.9em 1.25em;
        color: #ab0f78;
        background: transparent;
        border: solid 3px #ab0f78;
        border-radius: 0.3em;
        font-family: "Courier New", Courier, monospace;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        margin-bottom: 50px;
        width: 220px;
        text-align: center;
        align-self: center;
        margin-top: 50px;
      }

      .btn:hover {
        color: #ccc;
        border: solid 3px #ccc;
      }

      .download-btn {
        padding: 0.9em 1.25em;
        color: #ab0f78;
        background: transparent;
        border: solid 3px #ab0f78;
        border-radius: 0.3em;
        font-family: "Courier New", Courier, monospace;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        width: 220px;
        text-align: center;
        align-self: center;
      }

      .download-btn:hover {
        color: #ccc;
        border: solid 3px #ccc;
      }

      .download-btn:focus {
        outline: none;
      }

      .other-platform {
        color: #959595;
        font-size: 12px;
      }

      .other-platform:hover {
        color: #ccc;
      }

      footer {
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .links {
        display: flex;
        flex-direction: row;
        justify-content: space-evenly;
        margin-bottom: 30px;
      }

      @media screen and (max-width: 800px) and (min-width: 300px) {
        .start-container {
          flex-flow: row wrap;
          height: 100%;
        }

        .content-container {
          font-size: 13px;
        }

        .logLady-logo {
          width: 100%;
          margin-bottom: -50px;
        }

        .info-what {
          width: 90%;
          padding: 0px 15px;
        }

        .info-how {
          width: 90%;
          padding: 0px 15px;
        }

        .download-text {
          width: 90%;
          text-align: center;
          margin-bottom: 50px;
        }
      }
    </style>
    <script>
      const determineUserOS = () => {
        if (navigator.platform.startsWith("Mac")) {
          return "Mac";
        }
        if (navigator.platform.startsWith("Linux")) {
          return "Linux";
        }
        if (navigator.platform.startsWith("Win")) {
          return "Windows";
        }
      };
      window.onload = () => {
        let downloadButton = document.querySelector("button.download-btn"),
          downloadLink = "https://github.com/kits-ab/LogLady/releases/latest"; // Default state, link to the latest release on GitHub

        downloadButton.onclick = () => {
          location.href = downloadLink;
        };

        // Fetch information on the latest release using GitHub API and then update button text and link for the users OS
        fetch("https://api.github.com/repos/kits-ab/LogLady/releases/latest")
          .then(response => {
            if (response.status !== 200) {
              console.error(`GitHub API response not OK: ${response.status}`);
              return;
            }
            response.json().then(data => {
              // Determine what file extension is the correct one for user
              let wantedFileExtensionRegex;
              switch (determineUserOS()) {
                case "Mac":
                  downloadButton.innerText = "Download for Mac";
                  wantedFileExtensionRegex = /\.dmg$/g;
                  break;
                case "Linux":
                  downloadButton.innerText = "Download for Linux";
                  wantedFileExtensionRegex = /\.AppImage$/g;
                  break;
                case "Windows":
                  downloadButton.innerText = "Download for Windows";
                  wantedFileExtensionRegex = /\.exe$/g;
                  break;
                default:
                  wantedFileExtensionRegex = /^$/g; // Do-nothing regex
                  break;
              }

              // Loop through the assets in the release. Assume there is at least one AppImage, one dmg and one exe
              for (let index in data.assets) {
                let asset = data.assets[index];
                if (wantedFileExtensionRegex.test(asset.name)) {
                  // Update so the button links directly to the download of a file for the correct OS, if supported
                  downloadLink = asset.browser_download_url;
                }
              }
            });
          })
          .catch(err => {
            console.error(
              "An error occured while fetching information about latest release from GitHub API:",
              err
            );
          });
      };
    </script>
  </head>

  <body>
    <div class="start-container">
      <img class="logLady-logo" src="./resources/loglady.png" alt="Logo" />
      <div class="download-text ">
        <p>
          Making logs bearable!
        </p>
        <button class="download-btn">
          Download on GitHub
        </button>

        <p>
          <a
            class="other-platform"
            href="https://github.com/kits-ab/LogLady/releases/latest"
            >Other platforms
          </a>
        </p>
      </div>
    </div>
    <div class="content-container">
      <div class="info-what">
        <h3>What is LogLady?</h3>
        <p>
          LogLady is an open-source cross-platform application for managing
          logfiles.
        </p>
      </div>
      <div class="info-how">
        <h3>How to use</h3>
        <p>
          Simple download and install. Open file and let LogLady read it.
        </p>
        <video
          width="100%"
          playsinline
          loop
          autoplay
          muted
          src="./resources/loglady.mp4"
          type="video/mp4"
        ></video>
        <p>You can follow the log in real time</p>
        <img class="img-follow" src="./resources/Follow.png" alt="Follow" />
        <p>
          You can filter and highlight on whatever you want in your file with a 
          palette of the best colors we've chosen for you. Switch between plain 
          text match or a regular expression on the fly. Just add @ in the text 
          field to escape from plain text to regular expression. 
        </p>
        <img
          class="img-highlightAndFilter"
          src="./resources/highlightAndFilter.png"
          alt="highlightAndFilter"
        />
      </div>
    </div>

    <footer>
      <a class="btn" href="https://github.com/kits-ab/LogLady"
        >View source code on Github</a
      >

      <div class="links">
        <a href="https://github.com/kits-ab/LogLady/graphs/contributors"
          >About us</a
        >
        <a href="https://kits.se/">Kits</a>
        <a href="https://github.com/kits-ab/LogLady/releases">Releases</a>
      </div>
    </footer>
  </body>
</html>
